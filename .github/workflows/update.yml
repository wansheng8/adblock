name: Update Rules

on:
  schedule:
    - cron: '0 */6 * * *'  # æ¯6å°æ—¶è¿è¡Œä¸€æ¬¡
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  push:
    branches:
      - main
    paths:
      - 'rules/sources/*.txt'
      - 'run.py'

jobs:
  update:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Run update script
      run: python run.py
    
    - name: Generate README
      run: |
        python -c "
        import json
        from datetime import datetime
        
        with open('rules/outputs/info.json', 'r', encoding='utf-8') as f:
            info = json.load(f)
        
        update_time = info.get('last_updated', datetime.now().strftime('%Y-%m-%d %H:%M:%S'))
        
        readme_content = f'''# å¹¿å‘Šè¿‡æ»¤è§„åˆ™é›†åˆå™¨

ä¸€ä¸ªè‡ªåŠ¨æ›´æ–°çš„å¹¿å‘Šè¿‡æ»¤è§„åˆ™é›†åˆå™¨ï¼Œèšåˆå¤šä¸ªè§„åˆ™æºï¼Œç”Ÿæˆé€‚ç”¨äºAdblockã€DNSè¿‡æ»¤å’ŒHostsçš„è§„åˆ™æ–‡ä»¶ã€‚

## ğŸ“¦ è®¢é˜…é“¾æ¥

| è§„åˆ™ç±»å‹ | æ–‡ä»¶ | è®¢é˜…é“¾æ¥ | è§„åˆ™æ•°é‡ |
|---------|------|----------|----------|
| Adblock è§„åˆ™ | ad.txt | [https://cdn.jsdelivr.net/gh/wansheng8/adblock/rules/outputs/ad.txt](https://cdn.jsdelivr.net/gh/wansheng8/adblock/rules/outputs/ad.txt) | {info.get('ad_count', 0)} |
| DNS è§„åˆ™ | dns.txt | [https://cdn.jsdelivr.net/gh/wansheng8/adblock/rules/outputs/dns.txt](https://cdn.jsdelivr.net/gh/wansheng8/adblock/rules/outputs/dns.txt) | {info.get('dns_count', 0)} |
| Hosts è§„åˆ™ | hosts.txt | [https://cdn.jsdelivr.net/gh/wansheng8/adblock/rules/outputs/hosts.txt](https://cdn.jsdelivr.net/gh/wansheng8/adblock/rules/outputs/hosts.txt) | {info.get('hosts_count', 0)} |
| é»‘åå•è§„åˆ™ | black.txt | [https://cdn.jsdelivr.net/gh/wansheng8/adblock/rules/outputs/black.txt](https://cdn.jsdelivr.net/gh/wansheng8/adblock/rules/outputs/black.txt) | {info.get('black_count', 0)} |
| ç™½åå•è§„åˆ™ | white.txt | [https://cdn.jsdelivr.net/gh/wansheng8/adblock/rules/outputs/white.txt](https://cdn.jsdelivr.net/gh/wansheng8/adblock/rules/outputs/white.txt) | {info.get('white_count', 0)} |

> **æç¤º**: ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨åŸå§‹GitHubé“¾æ¥ï¼š`https://raw.githubusercontent.com/wansheng8/adblock/main/rules/outputs/[æ–‡ä»¶å]`

## ğŸ•’ æœ€æ–°æ›´æ–°æ—¶é—´
**{update_time}**

---

*è§„åˆ™æ¯6å°æ—¶è‡ªåŠ¨æ›´æ–°ä¸€æ¬¡*
'''
        
        with open('README.md', 'w', encoding='utf-8') as f:
            f.write(readme_content)
        "
    
    - name: Commit and push changes
      run: |
        git config --global user.name 'GitHub Actions'
        git config --global user.email 'actions@github.com'
        git add rules/outputs/* README.md
        git commit -m "Update rules: $(date +'%Y-%m-%d %H:%M:%S')" || echo "No changes to commit"
        git push
